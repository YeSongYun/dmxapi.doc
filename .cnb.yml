main:
  push:
    - imports: https://cnb.cool/dmxapi/claude-code-my/-/blob/main/env.yml
      runner:
        tags: cnb:arch:amd64
        cpus: 1
      stages:
        - name: sync to github
          image: tencentcom/git-sync
          settings:
            target_url: https://github.com/YeSongYun/dmxapi.doc.git
            auth_type: https
            username: ${GIT_USERNAME}
            password: ${GIT_ACCESS_TOKEN}
            force: true
  pull_request:
    - imports: https://cnb.cool/dmxapi/claude-code-my/-/blob/main/env.yml
      runner:
        tags: cnb:arch:amd64
        cpus: 1
      stages:
        - name: 代码评审
          image: cnbcool/ai-review:latest
          settings:
            type: code-review
            ai_chat_url: ${AI_CHAT_URL}
            ai_token: ${AI_TOKEN}
            ai_model: ${AI_MODEL}
            pr_comment: true
            max_comments: 10