# MiniMax-Music-2.0 AIéŸ³ä¹å¤§æ¨¡å‹APIä½¿ç”¨æ–‡æ¡£  

ä½¿ç”¨music-2.0æ¨¡å‹ï¼Œè¾“å…¥æ­Œè¯å’Œæ­Œæ›²æè¿°ï¼Œè¿›è¡Œæ­Œæ›²ç”Ÿæˆã€‚

## è¯·æ±‚åœ°å€

```
https://www.dmxapi.cn/v1/responses
```

## æ¨¡å‹åˆ—è¡¨

- `music-2.0` 




#### å‚æ•°è§£é‡Š


lyricså‚æ•°è§£é‡Šã€‚
![music-2.0](img\music-2.0.png)


## ç¤ºä¾‹ä»£ç 
::: code-group

```python [éæµå¼è¾“å‡º]
"""
================================================================================
DMXAPI éŸ³ä¹ç”Ÿæˆè„šæœ¬
================================================================================

åŠŸèƒ½è¯´æ˜:
    æœ¬è„šæœ¬é€šè¿‡ DMXAPI å¹³å°è°ƒç”¨éŸ³ä¹ç”Ÿæˆæ¨¡å‹ï¼ˆmusic-2.0ï¼‰ç”ŸæˆéŸ³ä¹ã€‚
    æ”¯æŒè‡ªå®šä¹‰æ­Œè¯ã€éŸ³ä¹é£æ ¼æè¿°å’ŒéŸ³é¢‘è¾“å‡ºè®¾ç½®ã€‚

ä½¿ç”¨æµç¨‹:
    1. é…ç½® API å¯†é’¥å’ŒéŸ³ä¹å‚æ•°
    2. è¿è¡Œè„šæœ¬ç”ŸæˆéŸ³ä¹
    3. éŸ³é¢‘æ–‡ä»¶å°†ä¿å­˜ä¸º output.mp3

ä¾èµ–åº“:
    - requests: HTTP è¯·æ±‚åº“
    - json: JSON å¤„ç†åº“
================================================================================
"""

import requests
import json

# ============================================================================
# é…ç½®éƒ¨åˆ† - API è¿æ¥ä¿¡æ¯
# ============================================================================

# DMXAPI çš„ URL åœ°å€
url = "https://www.dmxapi.cn/v1/responses"

# API å¯†é’¥ - ç”¨äºèº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶
api_key = "sk-***************************************"  # âš ï¸ è¯·æ›¿æ¢ä¸ºä½ çš„APIå¯†é’¥

# ============================================================================
# è¯·æ±‚å¤´é…ç½® - è®¾ç½®å†…å®¹ç±»å‹å’Œæˆæƒä¿¡æ¯
# ============================================================================
headers = {
    "Content-Type": "application/json",      # æŒ‡å®šè¯·æ±‚ä½“ä¸º JSON æ ¼å¼
    "Authorization": f"{api_key}",    # token è®¤è¯æ–¹å¼
}

# ============================================================================
# è¯·æ±‚å‚æ•°é…ç½® - éŸ³ä¹ç”Ÿæˆå‚æ•°
# ============================================================================
data = {
    # -------------------- åŸºç¡€é…ç½® --------------------
    "model": "music-2.0",                      # éŸ³ä¹ç”Ÿæˆæ¨¡å‹ç‰ˆæœ¬

    # éŸ³ä¹æè¿°
    # - é•¿åº¦é™åˆ¶: 10-2000 ä¸ªå­—ç¬¦
    "input": "è¿™æ˜¯ä¸€é¦–å……æ»¡è‡ªä¿¡ã€å¤§èƒ†æœå†³åŠ›é‡çš„å½“ä»£ R&B/Pop æ­Œæ›²ï¼Œå¹¶èå…¥äº†é²œæ˜çš„ Trap å…ƒç´ ã€‚æ­Œæ›²ç”±æ˜äº®ã€æ¸…æ¾ˆä¸”çµæ´»çš„å¥³å£°æ¼”ç»ï¼Œå…¶ç»è¿‡ç²¾å¿ƒå¤„ç†çš„ç°ä»£éŸ³è‰²æå…·è¾¨è¯†åº¦ï¼Œæ­Œæ‰‹è‡ªä¿¡çš„èŠ‚å¥æ€§å”±è…”ï¼Œç»“åˆæå…·é£æ ¼åŒ–çš„ Auto-Tune ä¿®éŸ³æ•ˆæœï¼Œæ„æˆäº†å…¶æ ¸å¿ƒå¬æ„Ÿã€‚å¤§é‡å±‚æ¬¡ä¸°å¯Œçš„å’Œå£°ã€ä¼´å”±ä¸å³å…´ç‚¹ç¼€ï¼Œé€šè¿‡ä¸»æ—‹å¾‹çš„åŒåº¦å’Œå£°å †å ï¼Œè¥é€ å‡ºé¥±æ»¡è€Œå……æ»¡èƒ½é‡çš„å¬è§‰ä½“éªŒï¼Œå¹¶é…ä»¥æ°åˆ°å¥½å¤„çš„æ··å“æ•ˆæœæ¥æå‡ç©ºé—´æ„Ÿã€‚åœ¨ 80 BPM çš„èŠ‚å¥ä¸‹ï¼Œç¼–æ›²ä»¥æ ‡å¿—æ€§çš„ 808 è´æ–¯å’Œé¼“ç‚¹ä½œä¸ºé©±åŠ¨ï¼Œæ­é…å¤æ‚çš„ç¢æ‹ä¸æ¸…è„†çš„æ‹æ‰‹å£°ï¼Œå¹¶ç”±æ°›å›´åˆæˆå™¨é“ºå«å‡ºå¹¿é˜”çš„èƒŒæ™¯ï¼ŒåŒæ—¶ç‚¹ç¼€ç€è¿‡æ¸¡æ€§çš„éŸ³æ•ˆï¼Œéå¸¸é€‚åˆåœ¨ä¿±ä¹éƒ¨ã€æ´¾å¯¹ã€é©¾è½¦æˆ–å¥èº«æ—¶æ”¶å¬ï¼Œä¸ºä½ çš„è‡ªä¿¡æ—¶åˆ»æ³¨å…¥èƒ½é‡ã€‚",

    # æ­Œè¯å†…å®¹
    # - é•¿åº¦é™åˆ¶: 10-3000 ä¸ªå­—ç¬¦
    # - æ¯è¡Œæ­Œè¯ç”¨æ¢è¡Œç¬¦åˆ†éš”
    # - å¯ä½¿ç”¨æ ‡ç­¾: [Intro], [Verse], [Chorus], [Bridge], [Outro]
    "lyrics": ("[intro]\n"
               "D.M.X., å–è‡ªAIæ¨¡å‹\n"
               "dmxapi, èšåˆæ™ºèƒ½\n"
               "æ™ºèƒ½ä¸­æ–‡ç½‘, ä¸ºä½ å¼€å¯\n"
               "AI åº”ç”¨çš„å¤§é—¨\n"
               "\n"
               "[verse]\n"
               "ä¸‰ç™¾å¤šæ¨¡å‹æ±‡èšä¸€å ‚\n"
               "æ–‡ç”Ÿæ–‡, æ–‡ç”Ÿå›¾, æ–‡ç”Ÿè§†é¢‘ä¸éŸ³é¢‘\n"
               "å¤šæ¨¡æ€çš„ä¸–ç•Œ, æ·±åº¦å­¦ä¹ çš„åŠ›é‡\n"
               "è‡ªç„¶è¯­è¨€å¤„ç†, å›¾åƒè¯†åˆ«åœ¨æŒä¸­\n"
               "\n"
               "[chorus]\n"
               "dmxapi, æ™ºèƒ½çš„é’¥åŒ™\n"
               "ä¸€ä¸ª Key æ‰“å¼€æ‰€æœ‰æ¨¡å‹\n"
               "æ–‡ç”Ÿå›¾, æ–‡ç”ŸéŸ³ä¹, æ–‡ç”Ÿè§†é¢‘å…¨éƒ½æœ‰\n"
               "å…¨çƒ API ç›´è¿, æœ¬åœ°è®¡ä»·\n"
               "\n"
               "[verse]\n"
               "æ³¨å†Œå°±æ˜¯æ»¡çº§, æ— é™å¹¶å‘\n"
               "æ²¡æœ‰ RPM é™åˆ¶, æ²¡æœ‰ TPM çƒ¦æ¼\n"
               "ä¼ä¸šé›†ç¾¤æœåŠ¡å™¨, æ”¯æŒå…¬å¯¹å…¬\n"
               "ä¼ä¸šæœåŠ¡, æ­£è§„æµç¨‹\n"
               "\n"
               "[bridge]\n"
               "ç›´æ¥ä¸åŸå‚åˆä½œ, é›†ä¸­é‡‡è´­\n"
               "å»æ‰ä¸­é—´ç¯èŠ‚, ä»·æ ¼æ›´ä¼˜\n"
               "é«˜æ€§ä»·æ¯”æ–¹æ¡ˆ, åŠ©åŠ›åˆ›æ–°\n"
               "èŠ‚çœé¢„ç®—, æå‡æ•ˆæœ\n"
               "\n"
               "[chorus]\n"
               "dmxapi, æ™ºèƒ½çš„é’¥åŒ™\n"
               "ä¸€ä¸ª Key æ‰“å¼€æ‰€æœ‰æ¨¡å‹\n"
               "æ–‡ç”Ÿå›¾, æ–‡ç”ŸéŸ³ä¹, æ–‡ç”Ÿè§†é¢‘å…¨éƒ½æœ‰\n"
               "å…¨çƒ API ç›´è¿, æœ¬åœ°è®¡ä»·\n"
               "\n"
               "[outro]\n"
               "dmxapi\n"
               "å¼€å¯ä½ çš„\n"
               "æ™ºèƒ½åˆ›ä½œä¹‹æ—…"),

    # -------------------- éŸ³é¢‘è®¾ç½® --------------------
    "audio_setting": {
        "sample_rate": 44100,                  # é‡‡æ ·ç‡ (å¯é€‰: 16000, 24000, 32000, 44100)
        "bitrate": 256000,                     # æ¯”ç‰¹ç‡ (å¯é€‰: 32000, 64000, 128000, 256000)
        "format": "mp3"                        # ç¼–ç æ ¼å¼ (å¯é€‰: mp3, wav, pcm)
    },

    # -------------------- æµå¼ä¼ è¾“å‚æ•° --------------------
    # stream: æ˜¯å¦ä½¿ç”¨æµå¼ä¼ è¾“ï¼Œé»˜è®¤ false
    "stream": False,

    # output_format: éŸ³é¢‘è¿”å›æ ¼å¼
    # - å¯é€‰å€¼: url, hex (é»˜è®¤ hex)
    # - stream=true æ—¶ä»…æ”¯æŒ hex
    # - url æœ‰æ•ˆæœŸ 24 å°æ—¶ï¼Œè¯·åŠæ—¶ä¸‹è½½
    "output_format": "hex",

    # aigc_watermark: æ˜¯å¦åœ¨éŸ³é¢‘æœ«å°¾æ·»åŠ æ°´å°
    # - é»˜è®¤ false
    # - ä»…åœ¨ stream=false æ—¶ç”Ÿæ•ˆ
    "aigc_watermark": False,
}

# ============================================================================
# å‘é€è¯·æ±‚å¹¶å¤„ç†å“åº”
# ============================================================================

print("ğŸµ å¼€å§‹ç”ŸæˆéŸ³ä¹...")
print(f"ğŸ“ éŸ³ä¹é£æ ¼: {data['input'][:50]}...")
print(f"ğŸ¤ æ­Œè¯é•¿åº¦: {len(data['lyrics'])} å­—ç¬¦")
print("-" * 60)

try:
    response = requests.post(url, headers=headers, json=data)
    response.raise_for_status()
    result = response.json()
    print("âœ… API å“åº”æˆåŠŸ")

    # æå–éŸ³é¢‘æ•°æ®ï¼ˆå…¼å®¹å¤šç§å“åº”æ ¼å¼ï¼‰
    audio_data = None
    if "output" in result and isinstance(result["output"], list):
        for item in result["output"]:
            for content in item.get("content", []):
                if "audio" in content:
                    audio_data = content["audio"]
                    break
    audio_data = audio_data or result.get("data", {}).get("audio") or result.get("audio")

    if audio_data:
        # ä¸‹è½½æˆ–è§£ç éŸ³é¢‘
        if audio_data.startswith("http"):
            audio_bytes = requests.get(audio_data).content
        else:
            audio_bytes = bytes.fromhex(audio_data)

        with open("output.mp3", "wb") as f:
            f.write(audio_bytes)
        print(f"ğŸ‰ éŸ³ä¹ç”ŸæˆæˆåŠŸï¼å·²ä¿å­˜ä¸º output.mp3")
        print(f"ğŸ“Š æ–‡ä»¶å¤§å°: {len(audio_bytes) / 1024 / 1024:.2f} MB")

    elif "error" in result:
        print(f"âŒ API é”™è¯¯: {result['error'].get('message', 'æœªçŸ¥é”™è¯¯')}")
    else:
        print("âš ï¸ æ„å¤–çš„å“åº”æ ¼å¼:")
        print(json.dumps(result, indent=2, ensure_ascii=False))

except requests.exceptions.RequestException as e:
    print(f"âŒ è¯·æ±‚é”™è¯¯: {e}")
except Exception as e:
    print(f"âŒ é”™è¯¯: {e}")

print("-" * 60)
print("ğŸ“Œ æç¤º: å¦‚æœç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥ APIå¯†é’¥ã€ç½‘ç»œè¿æ¥ã€DMXAPIæœåŠ¡çŠ¶æ€")

```

```python [æµå¼è¾“å‡º]
"""
================================================================================
DMXAPI éŸ³ä¹ç”Ÿæˆè„šæœ¬ - æµå¼ç‰ˆæœ¬
================================================================================

åŠŸèƒ½è¯´æ˜:
    æœ¬è„šæœ¬é€šè¿‡ DMXAPI å¹³å°è°ƒç”¨éŸ³ä¹ç”Ÿæˆæ¨¡å‹ï¼ˆmusic-2.0ï¼‰ç”ŸæˆéŸ³ä¹ã€‚
    ä½¿ç”¨æµå¼ä¼ è¾“ï¼ˆSSEï¼‰å®æ—¶æ¥æ”¶éŸ³é¢‘æ•°æ®ã€‚
    æ”¯æŒè‡ªå®šä¹‰æ­Œè¯ã€éŸ³ä¹é£æ ¼æè¿°å’ŒéŸ³é¢‘è¾“å‡ºè®¾ç½®ã€‚

ä½¿ç”¨æµç¨‹:
    1. é…ç½® API å¯†é’¥å’ŒéŸ³ä¹å‚æ•°
    2. è¿è¡Œè„šæœ¬ç”ŸæˆéŸ³ä¹ï¼ˆæµå¼æ¥æ”¶ï¼‰
    3. éŸ³é¢‘æ–‡ä»¶å°†ä¿å­˜ä¸º output_stream.mp3

ç‰¹æ€§:
    - æµå¼ä¼ è¾“ï¼Œå®æ—¶æ˜¾ç¤ºç”Ÿæˆè¿›åº¦
    - æ”¯æŒå¤§æ–‡ä»¶ä¼ è¾“
    - é™ä½å†…å­˜å ç”¨

ä¾èµ–åº“:
    - requests: HTTP è¯·æ±‚åº“
    - json: JSON å¤„ç†åº“

================================================================================
"""

import requests
import json

# ============================================================================
# é…ç½®éƒ¨åˆ† - API è¿æ¥ä¿¡æ¯
# ============================================================================

# DMXAPI çš„ URL åœ°å€
url = "https://www.dmxapi.cn/v1/responses"

# API å¯†é’¥ - ç”¨äºèº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶
api_key = "sk-**************************************"  # âš ï¸ è¯·æ›¿æ¢ä¸ºä½ çš„APIå¯†é’¥

# ============================================================================
# è¯·æ±‚å¤´é…ç½® - è®¾ç½®å†…å®¹ç±»å‹å’Œæˆæƒä¿¡æ¯
# ============================================================================
headers = {
    "Content-Type": "application/json",      # æŒ‡å®šè¯·æ±‚ä½“ä¸º JSON æ ¼å¼
    "Authorization": f"{api_key}",    # token è®¤è¯æ–¹å¼
}

# ============================================================================
# è¯·æ±‚å‚æ•°é…ç½® - éŸ³ä¹ç”Ÿæˆå‚æ•°ï¼ˆæµå¼ç‰ˆæœ¬ï¼‰
# ============================================================================
data = {
    # -------------------- åŸºç¡€é…ç½® --------------------
    "model": "music-2.0",                      # éŸ³ä¹ç”Ÿæˆæ¨¡å‹ç‰ˆæœ¬

    # éŸ³ä¹æè¿°
    # - é•¿åº¦é™åˆ¶: 10-2000 ä¸ªå­—ç¬¦
    "input": "è¿™æ˜¯ä¸€é¦–å……æ»¡è‡ªä¿¡ã€å¤§èƒ†æœå†³åŠ›é‡çš„å½“ä»£ R&B/Pop æ­Œæ›²ï¼Œå¹¶èå…¥äº†é²œæ˜çš„ Trap å…ƒç´ ã€‚æ­Œæ›²ç”±æ˜äº®ã€æ¸…æ¾ˆä¸”çµæ´»çš„å¥³å£°æ¼”ç»ï¼Œå…¶ç»è¿‡ç²¾å¿ƒå¤„ç†çš„ç°ä»£éŸ³è‰²æå…·è¾¨è¯†åº¦ï¼Œæ­Œæ‰‹è‡ªä¿¡çš„èŠ‚å¥æ€§å”±è…”ï¼Œç»“åˆæå…·é£æ ¼åŒ–çš„ Auto-Tune ä¿®éŸ³æ•ˆæœï¼Œæ„æˆäº†å…¶æ ¸å¿ƒå¬æ„Ÿã€‚å¤§é‡å±‚æ¬¡ä¸°å¯Œçš„å’Œå£°ã€ä¼´å”±ä¸å³å…´ç‚¹ç¼€ï¼Œé€šè¿‡ä¸»æ—‹å¾‹çš„åŒåº¦å’Œå£°å †å ï¼Œè¥é€ å‡ºé¥±æ»¡è€Œå……æ»¡èƒ½é‡çš„å¬è§‰ä½“éªŒï¼Œå¹¶é…ä»¥æ°åˆ°å¥½å¤„çš„æ··å“æ•ˆæœæ¥æå‡ç©ºé—´æ„Ÿã€‚åœ¨ 80 BPM çš„èŠ‚å¥ä¸‹ï¼Œç¼–æ›²ä»¥æ ‡å¿—æ€§çš„ 808 è´æ–¯å’Œé¼“ç‚¹ä½œä¸ºé©±åŠ¨ï¼Œæ­é…å¤æ‚çš„ç¢æ‹ä¸æ¸…è„†çš„æ‹æ‰‹å£°ï¼Œå¹¶ç”±æ°›å›´åˆæˆå™¨é“ºå«å‡ºå¹¿é˜”çš„èƒŒæ™¯ï¼ŒåŒæ—¶ç‚¹ç¼€ç€è¿‡æ¸¡æ€§çš„éŸ³æ•ˆï¼Œéå¸¸é€‚åˆåœ¨ä¿±ä¹éƒ¨ã€æ´¾å¯¹ã€é©¾è½¦æˆ–å¥èº«æ—¶æ”¶å¬ï¼Œä¸ºä½ çš„è‡ªä¿¡æ—¶åˆ»æ³¨å…¥èƒ½é‡ã€‚",

    # æ­Œè¯å†…å®¹
    # - é•¿åº¦é™åˆ¶: 10-3000 ä¸ªå­—ç¬¦
    # - æ¯è¡Œæ­Œè¯ç”¨æ¢è¡Œç¬¦åˆ†éš”
    # - å¯ä½¿ç”¨æ ‡ç­¾: [Intro], [Verse], [Chorus], [Bridge], [Outro]
    "lyrics": ("[intro]\n"
               "D.M.X., å–è‡ªAIæ¨¡å‹\n"
               "dmxapi, èšåˆæ™ºèƒ½\n"
               "æ™ºèƒ½ä¸­æ–‡ç½‘, ä¸ºä½ å¼€å¯\n"
               "AI åº”ç”¨çš„å¤§é—¨\n"
               "\n"
               "[verse]\n"
               "ä¸‰ç™¾å¤šæ¨¡å‹æ±‡èšä¸€å ‚\n"
               "æ–‡ç”Ÿæ–‡, æ–‡ç”Ÿå›¾, æ–‡ç”Ÿè§†é¢‘ä¸éŸ³é¢‘\n"
               "å¤šæ¨¡æ€çš„ä¸–ç•Œ, æ·±åº¦å­¦ä¹ çš„åŠ›é‡\n"
               "è‡ªç„¶è¯­è¨€å¤„ç†, å›¾åƒè¯†åˆ«åœ¨æŒä¸­\n"
               "\n"
               "[chorus]\n"
               "dmxapi, æ™ºèƒ½çš„é’¥åŒ™\n"
               "ä¸€ä¸ª Key æ‰“å¼€æ‰€æœ‰æ¨¡å‹\n"
               "æ–‡ç”Ÿå›¾, æ–‡ç”ŸéŸ³ä¹, æ–‡ç”Ÿè§†é¢‘å…¨éƒ½æœ‰\n"
               "å…¨çƒ API ç›´è¿, æœ¬åœ°è®¡ä»·\n"
               "\n"
               "[verse]\n"
               "æ³¨å†Œå°±æ˜¯æ»¡çº§, æ— é™å¹¶å‘\n"
               "æ²¡æœ‰ RPM é™åˆ¶, æ²¡æœ‰ TPM çƒ¦æ¼\n"
               "ä¼ä¸šé›†ç¾¤æœåŠ¡å™¨, æ”¯æŒå…¬å¯¹å…¬\n"
               "ä¼ä¸šæœåŠ¡, æ­£è§„æµç¨‹\n"
               "\n"
               "[bridge]\n"
               "ç›´æ¥ä¸åŸå‚åˆä½œ, é›†ä¸­é‡‡è´­\n"
               "å»æ‰ä¸­é—´ç¯èŠ‚, ä»·æ ¼æ›´ä¼˜\n"
               "é«˜æ€§ä»·æ¯”æ–¹æ¡ˆ, åŠ©åŠ›åˆ›æ–°\n"
               "èŠ‚çœé¢„ç®—, æå‡æ•ˆæœ\n"
               "\n"
               "[chorus]\n"
               "dmxapi, æ™ºèƒ½çš„é’¥åŒ™\n"
               "ä¸€ä¸ª Key æ‰“å¼€æ‰€æœ‰æ¨¡å‹\n"
               "æ–‡ç”Ÿå›¾, æ–‡ç”ŸéŸ³ä¹, æ–‡ç”Ÿè§†é¢‘å…¨éƒ½æœ‰\n"
               "å…¨çƒ API ç›´è¿, æœ¬åœ°è®¡ä»·\n"
               "\n"
               "[outro]\n"
               "dmxapi\n"
               "å¼€å¯ä½ çš„\n"
               "æ™ºèƒ½åˆ›ä½œä¹‹æ—…"),

    # -------------------- éŸ³é¢‘è®¾ç½® --------------------
    "audio_setting": {
        "sample_rate": 44100,                  # é‡‡æ ·ç‡ (å¯é€‰: 16000, 24000, 32000, 44100)
        "bitrate": 256000,                     # æ¯”ç‰¹ç‡ (å¯é€‰: 32000, 64000, 128000, 256000)
        "format": "mp3"                        # ç¼–ç æ ¼å¼ (å¯é€‰: mp3, wav, pcm)
    },

    # -------------------- æµå¼ä¼ è¾“å‚æ•° --------------------
    # stream: æ˜¯å¦ä½¿ç”¨æµå¼ä¼ è¾“ï¼Œé»˜è®¤ false
    "stream": True,

    # output_format: éŸ³é¢‘è¿”å›æ ¼å¼
    # - å¯é€‰å€¼: url, hex (é»˜è®¤ hex)
    # - stream=true æ—¶ä»…æ”¯æŒ hex
    # - url æœ‰æ•ˆæœŸ 24 å°æ—¶ï¼Œè¯·åŠæ—¶ä¸‹è½½
    "output_format": "hex",

    # aigc_watermark: æ˜¯å¦åœ¨éŸ³é¢‘æœ«å°¾æ·»åŠ æ°´å°
    # - é»˜è®¤ false
    # - ä»…åœ¨ stream=false æ—¶ç”Ÿæ•ˆ
    "aigc_watermark": False,
}

# ============================================================================
# æµå¼å“åº”å¤„ç†å‡½æ•°
# ============================================================================

def parse_sse_line(line):
    """
    è§£æSSEï¼ˆServer-Sent Eventsï¼‰æ ¼å¼çš„è¡Œ

    SSEæ ¼å¼ç¤ºä¾‹:
    data: {"id":"123","audio_chunk":"hex_data"}
    """
    if line.startswith("data: "):
        try:
            # ç§»é™¤ "data: " å‰ç¼€å¹¶è§£æJSON
            json_str = line[6:]  # "data: " é•¿åº¦ä¸º6
            if json_str.strip() and json_str.strip() != "[DONE]":
                return json.loads(json_str)
        except json.JSONDecodeError as e:
            print(f"âš ï¸ è§£æè¡Œå¤±è´¥: {e}")
            print(f"   åŸå§‹è¡Œ: {line}")
    return None

# ============================================================================
# å‘é€è¯·æ±‚å¹¶å¤„ç†æµå¼å“åº”
# ============================================================================

print("ğŸµ å¼€å§‹ç”ŸæˆéŸ³ä¹...")
print(f"ğŸ“ éŸ³ä¹é£æ ¼: {data['input'][:50]}...")
print(f"ğŸ¤ æ­Œè¯é•¿åº¦: {len(data['lyrics'])} å­—ç¬¦")
print("-" * 60)

# ç”¨äºå­˜å‚¨éŸ³é¢‘å—
audio_chunks = []

def extract_audio(data, keys=["data", "audio", "audio_data", "content", "hex", "base64"]):
    """ä»å­—å…¸ä¸­æå–éŸ³é¢‘æ•°æ®"""
    for key in keys:
        if key in data:
            return data[key]
    return None

def extract_audio_from_output(output_list):
    """ä» output åˆ—è¡¨ä¸­æå–éŸ³é¢‘"""
    for item in output_list:
        if item.get("type") == "message":
            for content in item.get("content", []):
                if content.get("type") == "output_audio":
                    return extract_audio(content)
    return None

try:
    response = requests.post(url, headers=headers, json=data, stream=True)
    response.raise_for_status()

    for line in response.iter_lines():
        if not line:
            continue

        parsed = parse_sse_line(line.decode('utf-8').strip())
        if not parsed:
            continue

        # æµå¼éŸ³é¢‘å—
        if "audio_chunk" in parsed:
            audio_chunks.append(parsed["audio_chunk"])
        # å®Œæ•´éŸ³é¢‘ï¼ˆæ—§æ ¼å¼ï¼‰
        elif "audio" in parsed:
            audio_chunks = [parsed["audio"]]
            break
        # output æ ¼å¼
        elif "output" in parsed:
            audio = extract_audio_from_output(parsed["output"])
            if audio:
                audio_chunks = [audio]
            if parsed.get("type") == "response.completed":
                break
        # response åŒ…è£…æ ¼å¼
        elif "response" in parsed:
            resp = parsed["response"]
            audio = extract_audio_from_output(resp.get("output", []))
            if not audio:
                audio = extract_audio(resp)
            if audio and (not isinstance(audio, str) or len(audio) > 1000):
                audio_chunks = [audio] if isinstance(audio, str) else audio
            if parsed.get("type") == "response.completed":
                break
        # é”™è¯¯å¤„ç†
        elif "error" in parsed:
            print(f"âŒ API é”™è¯¯: {parsed['error'].get('message', 'æœªçŸ¥é”™è¯¯')}")
            break
        elif parsed.get("status") == "failed":
            print(f"âŒ ç”Ÿæˆå¤±è´¥: {parsed.get('message', 'æœªçŸ¥é”™è¯¯')}")
            break

    # ä¿å­˜éŸ³é¢‘
    if audio_chunks:
        audio_bytes = bytes.fromhex("".join(audio_chunks))
        output_file = "output_stream.mp3"
        with open(output_file, "wb") as f:
            f.write(audio_bytes)

        file_size_mb = len(audio_bytes) / 1024 / 1024
        print(f"âœ… éŸ³ä¹ç”ŸæˆæˆåŠŸï¼å·²ä¿å­˜ä¸º {output_file}")
        print(f"ğŸ“Š æ–‡ä»¶å¤§å°: {file_size_mb:.2f} MB")

        with open("music-2.0.json", "w", encoding="utf-8") as f:
            json.dump({
                "model": data["model"], "input": data["input"], "lyrics": data["lyrics"],
                "audio_setting": data["audio_setting"], "output_file": output_file,
                "file_size_bytes": len(audio_bytes), "file_size_mb": round(file_size_mb, 2)
            }, f, ensure_ascii=False, indent=2)
    else:
        print("âŒ æœªæ¥æ”¶åˆ°éŸ³é¢‘æ•°æ®")

except requests.exceptions.RequestException as e:
    print(f"âŒ è¯·æ±‚é”™è¯¯: {e}")
except KeyboardInterrupt:
    print("\nâŒ ç”¨æˆ·ä¸­æ–­")
except Exception as e:
    print(f"âŒ é”™è¯¯: {e}")

print("-" * 60)
print("ğŸ“Œ æç¤º: å¦‚æœç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥ APIå¯†é’¥ã€ç½‘ç»œè¿æ¥ã€DMXAPIæœåŠ¡çŠ¶æ€")
```
:::

## è¿”å›ç¤ºä¾‹
::: code-group

```json [è¿”å›ç¤ºä¾‹ï¼ˆéæµå¼è¾“å‡ºï¼‰]
ğŸµ å¼€å§‹ç”ŸæˆéŸ³ä¹...
ğŸ“ éŸ³ä¹é£æ ¼: è¿™æ˜¯ä¸€é¦–å……æ»¡è‡ªä¿¡ã€å¤§èƒ†æœå†³åŠ›é‡çš„å½“ä»£ R&B/Pop æ­Œæ›²ï¼Œå¹¶èå…¥äº†é²œæ˜çš„ Trap å…ƒç´ ã€‚æ­Œæ›²ç”±æ˜...
ğŸ¤ æ­Œè¯é•¿åº¦: 429 å­—ç¬¦
------------------------------------------------------------
âœ… API å“åº”æˆåŠŸ
ğŸ‰ éŸ³ä¹ç”ŸæˆæˆåŠŸï¼å·²ä¿å­˜ä¸º output.mp3
ğŸ“Š æ–‡ä»¶å¤§å°: 2.49 MB
------------------------------------------------------------
ğŸ“Œ æç¤º: å¦‚æœç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥ APIå¯†é’¥ã€ç½‘ç»œè¿æ¥ã€DMXAPIæœåŠ¡çŠ¶æ€

```

```json [è¿”å›ç¤ºä¾‹ï¼ˆæµå¼è¾“å‡ºï¼‰]
ğŸµ å¼€å§‹ç”ŸæˆéŸ³ä¹...
ğŸ“ éŸ³ä¹é£æ ¼: è¿™æ˜¯ä¸€é¦–å……æ»¡è‡ªä¿¡ã€å¤§èƒ†æœå†³åŠ›é‡çš„å½“ä»£ R&B/Pop æ­Œæ›²ï¼Œå¹¶èå…¥äº†é²œæ˜çš„ Trap å…ƒç´ ã€‚æ­Œæ›²ç”±æ˜...
ğŸ¤ æ­Œè¯é•¿åº¦: 429 å­—ç¬¦
------------------------------------------------------------
âœ… API å“åº”æˆåŠŸ
ğŸ‰ éŸ³ä¹ç”ŸæˆæˆåŠŸï¼å·²ä¿å­˜ä¸º output_stream.mp3
ğŸ“Š æ–‡ä»¶å¤§å°: 5.06 MB
------------------------------------------------------------
ğŸ“Œ æç¤º: å¦‚æœç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥ APIå¯†é’¥ã€ç½‘ç»œè¿æ¥ã€DMXAPIæœåŠ¡çŠ¶æ€
```
:::




#### API å¯†é’¥å®‰å…¨

âš ï¸ **é‡è¦**ï¼šç¤ºä¾‹ä»£ç ä¸­çš„ API å¯†é’¥ä»…ä¾›æ¼”ç¤ºï¼Œè¯·åŠ¡å¿…ï¼š

- ä½¿ç”¨æ‚¨è‡ªå·±çš„ API å¯†é’¥
- ä¸è¦å°†å¯†é’¥ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
- å»ºè®®é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†å¯†é’¥
- ä¸è¦å°†åŒ…å«çœŸå®å¯†é’¥çš„ä»£ç æäº¤åˆ°å…¬å¼€ä»“åº“


---

<p align="center">
  <small>Â© 2025 DMXAPI music-2.0 éŸ³ä¹æ¨¡å‹</small>
</p>